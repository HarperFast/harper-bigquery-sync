# File: config.multi-table.yaml
# Multi-Table BigQuery Sync Configuration Example
#
# This example shows how to sync multiple BigQuery tables to separate Harper tables.
# Each table can have its own sync settings, batch sizes, and column selections.
#
# IMPORTANT: Each BigQuery table MUST sync to a DIFFERENT Harper table.
# Multiple BigQuery tables syncing to the same targetTable will cause:
# - Record ID collisions and overwrites
# - Validation failures
# - Checkpoint confusion
# If you need combined data, sync to separate tables and join at query time.

pluginModule: ./src/index.js

rest: true

graphqlSchema:
  files: 'schema/harper-bigquery-sync.graphql'

jsResource:
  files: 'src/resources.js'

# Multi-Table BigQuery Configuration
bigquery:
  # Shared credentials and project settings
  projectId: your-gcp-project-id
  credentials: service-account-key.json
  location: US # BigQuery dataset location (US, EU, or specific region)

  # Define multiple tables to sync
  tables:
    # Table 1: High-frequency vessel position data
    - id: vessel_positions
      dataset: maritime_tracking
      table: vessel_positions
      timestampColumn: timestamp
      columns: [timestamp, mmsi, vessel_name, latitude, longitude, speed_knots, heading, course]
      targetTable: VesselPositions # Harper table name
      sync:
        initialBatchSize: 10000
        catchupBatchSize: 1000
        steadyBatchSize: 500

    # Table 2: Medium-frequency port events
    - id: port_events
      dataset: maritime_tracking
      table: port_events
      timestampColumn: event_time # Different timestamp column name
      columns: [event_time, port_id, vessel_mmsi, event_type, status, cargo_info]
      targetTable: PortEvents # Different Harper table
      sync:
        initialBatchSize: 5000
        catchupBatchSize: 500
        steadyBatchSize: 100

    # Table 3: Low-frequency vessel metadata updates
    - id: vessel_metadata
      dataset: maritime_tracking
      table: vessel_metadata
      timestampColumn: last_updated
      columns: ['*'] # Fetch all columns
      targetTable: VesselMetadata
      sync:
        initialBatchSize: 1000
        catchupBatchSize: 100
        steadyBatchSize: 10

# Global sync settings (apply to all tables unless overridden)
sync:
  # Lag thresholds (seconds)
  catchupThreshold: 3600 # 1 hour
  steadyThreshold: 300 # 5 minutes

  # Polling interval in steady state (milliseconds)
  pollInterval: 30000 # 30 seconds

validation:
  enabled: true
  interval: 300 # Run every 5 minutes

retry:
  maxAttempts: 5
  backoffMultiplier: 2
  initialDelay: 1000 # milliseconds
