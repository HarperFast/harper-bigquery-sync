# File: config.yaml
# BigQuery Sync Configuration - Multi-Table Format
#
# This demonstrates v1.0 features: multi-table sync with column selection.
# For legacy single-table format, see comments at bottom of file.

pluginModule: ./src/index.js

rest: true

graphqlSchema:
  files: 'schema/harper-bigquery-sync.graphql'

jsResource:
  files: 'src/resources.js'

# Operations API Configuration (for dynamic table creation)
# When configured, Harper tables are created automatically based on BigQuery schema
# No schema.graphql definitions needed for data tables
operations:
  host: localhost
  port: 9925
  username: admin
  password: password # Change this to your Harper password

# Multi-Table BigQuery Configuration
bigquery:
  # Shared credentials and project settings
  projectId: irjudson-demo
  credentials: service-account-key.json
  location: US

  # Define tables to sync (each syncs independently)
  tables:
    # High-frequency vessel position tracking
    - id: vessel_positions
      dataset: maritime_tracking
      table: vessel_positions
      timestampColumn: timestamp
      columns: [timestamp, mmsi, vessel_name, latitude, longitude, speed_knots, heading, course]
      targetTable: VesselPositions
      sync:
        initialBatchSize: 10000
        catchupBatchSize: 1000
        steadyBatchSize: 500

    # Port arrival/departure events
    - id: port_events
      dataset: maritime_tracking
      table: port_events
      timestampColumn: event_time
      columns: [event_time, port_id, port_name, vessel_mmsi, event_type, latitude, longitude]
      targetTable: PortEvents
      sync:
        initialBatchSize: 5000
        catchupBatchSize: 500
        steadyBatchSize: 100
      # Optional: Enable streaming inserts for lower latency (has cost implications)
      # useStreamingAPIs: true

    # Vessel metadata updates
    - id: vessel_metadata
      dataset: maritime_tracking
      table: vessel_metadata
      timestampColumn: last_updated
      columns: ['*']
      targetTable: VesselMetadata
      sync:
        initialBatchSize: 1000
        catchupBatchSize: 100
        steadyBatchSize: 10

# BigQuery Insert Method Configuration
# Two options available (configurable per table):
#
# 1. Load Job API (default):
#    - Free tier compatible (no per-row costs)
#    - Higher latency (seconds to minutes)
#    - Best for: development, batch workloads, cost-sensitive deployments
#    - Set useStreamingAPIs: false (or omit)
#
# 2. Streaming Insert API:
#    - Lower latency (sub-second to few seconds)
#    - Costs: $0.01 per 200 MB (minimum $0.01/day)
#    - Best for: production, real-time dashboards, low-latency requirements
#    - Set useStreamingAPIs: true
#
# Example: Enable streaming for time-sensitive events
#   - id: port_events
#     useStreamingAPIs: true  # Real-time events benefit from low latency

# Maritime vessel data synthesizer configuration
# When bigquery.tables is present, synthesizer uses multi-table orchestrator
# to generate data for ALL tables (vessel_positions, port_events, vessel_metadata).
# The dataset/table fields below are used as defaults for single-table mode.
synthesizer:
  dataset: maritime_tracking
  table: vessel_positions
  totalVessels: 100000
  batchSize: 100
  generationIntervalMs: 60000
  retentionDays: 30
  cleanupIntervalHours: 24

# Default settings
sync:
  # Start timestamp (ISO format) - omit to start from beginning
  # startTimestamp: "2024-01-01T00:00:00Z"

  # Batch sizes for different phases
  initialBatchSize: 10000
  catchupBatchSize: 1000
  steadyBatchSize: 500

  # Lag thresholds (seconds)
  catchupThreshold: 3600 # 1 hour
  steadyThreshold: 300 # 5 minutes

  # Polling interval in steady state (milliseconds)
  pollInterval: 30000 # 30 seconds

validation:
  enabled: true
  interval: 300 # Run every 5 minutes

retry:
  maxAttempts: 5
  backoffMultiplier: 2
  initialDelay: 1000 # milliseconds

# ============================================================================
# LEGACY SINGLE-TABLE FORMAT (still supported for backward compatibility)
# ============================================================================
# Uncomment and use this format if you only need to sync one table:
#
# bigquery:
#   projectId: irjudson-demo
#   dataset: maritime_tracking
#   table: vessel_positions
#   timestampColumn: timestamp
#   credentials: service-account-key.json
#   location: US
#   columns: [timestamp, mmsi, vessel_name, latitude, longitude, speed_knots]
#
# sync:
#   initialBatchSize: 10000
#   catchupBatchSize: 1000
#   steadyBatchSize: 500
#   pollInterval: 30000

