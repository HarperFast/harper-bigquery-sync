/**
 * Tests for generator.js
 *
 * Note: Full generator tests are memory-intensive due to journey tracking.
 * These tests verify critical functionality without exhausting memory.
 */

import { describe, it } from 'node:test';
import assert from 'node:assert';
import MaritimeVesselGenerator from '../src/generator.js';

describe('Maritime Vessel Generator', () => {
  describe('basic functionality', () => {
    it('should initialize with configuration', () => {
      const generator = new MaritimeVesselGenerator({
        totalVessels: 10,
        vesselsPerBatch: 5
      });

      assert.strictEqual(generator.totalVessels, 10);
      assert.strictEqual(generator.vesselsPerBatch, 5);
      assert.strictEqual(generator.vessels.length, 10);
    });

    it('should generate vessel with required fields', () => {
      const generator = new MaritimeVesselGenerator({ totalVessels: 5 });
      const vessel = generator.generateVessel();

      assert.ok(vessel.mmsi);
      assert.ok(vessel.imo);
      assert.ok(vessel.vessel_name);
      assert.ok(vessel.vessel_type);
      assert.ok(vessel.flag);
      assert.ok(typeof vessel.length === 'number');
      assert.ok(typeof vessel.beam === 'number');
      assert.ok(typeof vessel.draft === 'number');
    });

    it('should generate a single batch of records', () => {
      const generator = new MaritimeVesselGenerator({
        totalVessels: 10,
        vesselsPerBatch: 5
      });

      const batch = generator.generateBatch();

      assert.strictEqual(batch.length, 5);

      // Verify first record structure
      const record = batch[0];
      assert.ok(record.mmsi);
      assert.ok(record.timestamp);
      assert.ok(record.report_date);
      assert.ok(typeof record.latitude === 'number');
      assert.ok(typeof record.longitude === 'number');
      assert.ok(typeof record.speed_knots === 'number');
    });

    it('should accept custom timestamp', () => {
      const generator = new MaritimeVesselGenerator({ totalVessels: 5 });
      const customDate = new Date('2024-01-01T00:00:00Z');
      const batch = generator.generateBatch(customDate);

      assert.strictEqual(batch[0].timestamp, customDate.toISOString());
      assert.strictEqual(batch[0].report_date, '20240101');
    });
  });
});
